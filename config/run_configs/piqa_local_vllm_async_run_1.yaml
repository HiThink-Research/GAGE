# =================================================================
# 只读模板快照（修改本段不影响模板定义）
# Template: piqa_local_vllm_async version=V1 monolithic=False
# -----------------------------------------------------------------
# Datasets:
#   - dataset_id: piqa_validation_local
#     loader: jsonl
#     提示：可在 runtime.datasets.<id> 覆盖 hub_params.limit/local_path 等路径配置以指向本地测试集。
# Backends:
#   - backend_id: piqa_local_vllm_backend
#     type: vllm
#     async_max_concurrency: 32
# Steps:
#   - step: inference
#     adapter_id: <auto>
#   - step: auto_eval
#     adapter_id: <auto>
# Metrics:
#   - metric_id: piqa_acc
#     implementation: multi_choice_accuracy
# =================================================================
api_version: gage/v1alpha1

kind: RunConfig

metadata:
  name: piqa_local_vllm_async_run

base_task: builtin/piqa_local_vllm_async

template_version: V1

template_digest: sha256:154646281f3f26e71a32c013d90588e149f9ffa240f2fec29c33a099fd5ef511

# runtime 覆盖示例（按需修改下方键值）：
#   runtime.datasets.piqa_validation_local: {...}  # 可整体替换为本地数据集配置
#   runtime.backends.piqa_local_vllm_backend: {...}  # 切换模型服务/参数
#   runtime.tasks.piqa_validation_eval.max_samples: 50  # 控制本次运行样本数
runtime:
  datasets:
    piqa_validation_local:
      loader: jsonl
      params:
        path: /mnt/aime_data_ssd/user_workspace/zhuwenqiao/hub/cmp/ths/piqa_100.jsonl
  backends:
    piqa_local_vllm_backend:
      type: vllm
      config:
        model_path: /mnt/model/qwen2_5_05B
        tensor_parallel_size: 1
        max_tokens: 96
        sampling_params:
          temperature: 0.0
        max_batch_size: 32
        max_model_len: 2048
        gpu_memory_utilization: 0.9
        batch_timeout_ms: 30
        async_max_concurrency: 32
  tasks:
    piqa_validation_eval:
      max_samples: 500
      concurrency: 32
  global:
    output_path: ${GAGE_EVAL_SAVE_DIR:-./runs}/piqa_local_vllm_async_events.jsonl