api_version: gage/v1alpha1
kind: PipelineConfig

metadata:
  name: gomoku_litellm_local
  description: Local Gomoku arena with LiteLLM backend (LLM vs LLM).

custom:
  steps:
    - step: support
      adapter_id: gomoku_context_provider
    - step: arena
      adapter_id: gomoku_arena
    - step: auto_eval

datasets:
  - dataset_id: gomoku_local_litellm
    loader: jsonl
    params:
      path: tests/data/Test_Gomoku_LiteLLM.jsonl
      preprocess: grid_game_preprocessor
      streaming: false

backends:
  - backend_id: gomoku_litellm
    type: litellm
    config:
      provider: openai
      api_base: https://api.openai.com/v1
      model: gpt-5.2
      provider: openai
      generation_parameters:
        max_new_tokens: 1024
        temperature: 0.0
      streaming: false
      max_retries: 6      
  - backend_id: gomoku_litellm2
    type: litellm
    config:
      provider: openai
      api_base: https://api.openai.com/v1
      model: gpt-4.1
      provider: openai
      generation_parameters:
        max_new_tokens: 1024
        temperature: 0.0
      streaming: false
      max_retries: 6       

role_adapters:
  - adapter_id: gomoku_context_provider
    role_type: context_provider
    params:
      implementation: gomoku_context

  - adapter_id: gomoku_black_litellm
    role_type: dut_model
    backend_id: gomoku_litellm
    capabilities:
      - chat_completion

  - adapter_id: gomoku_white_litellm
    role_type: dut_model
    backend_id: gomoku_litellm2
    capabilities:
      - chat_completion

  - adapter_id: gomoku_arena
    role_type: arena
    params:
      environment:
        impl: gomoku_local_v1
        board_size: 15
        coord_scheme: A1
      rules:
        win_len: 5
        illegal_policy:
          retry: 1
          on_fail: loss
      scheduler:
        type: turn
        max_turns: 225
      parser:
        impl: grid_parser_v1
        coord_scheme: A1
      visualizer:
        enabled: true
        title: GAGE Gomoku Arena
        port: ${GOMOKU_GRADIO_PORT:-7861}
        launch_browser: true
        refresh_s: 0.1
        wait_for_finish: true
        coord_scheme: A1
        renderer:
          impl: gomoku_board_v1
      players:
        - name: Black
          type: backend
          ref: gomoku_black_litellm
          max_retries: 1
          fallback_policy: first_legal
        - name: White
          type: backend
          ref: gomoku_white_litellm
          max_retries: 1
          fallback_policy: first_legal

metrics:
  - metric_id: gomoku_win_rate_black
    implementation: gomoku_win_rate
    params:
      target_player: Black
  - metric_id: gomoku_illegal_rate
    implementation: gomoku_illegal_rate
  - metric_id: gomoku_avg_turns
    implementation: gomoku_avg_turns

tasks:
  - task_id: gomoku_litellm_local
    dataset_id: gomoku_local_litellm
    max_samples: 1
    concurrency: 1
    reporting:
      sinks:
        - type: console
        - type: file
          params:
            output_path: ${GAGE_EVAL_SAVE_DIR:-./runs}/gomoku_litellm_events.jsonl
