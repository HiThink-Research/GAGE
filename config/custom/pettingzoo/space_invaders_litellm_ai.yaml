api_version: gage/v1alpha1
kind: PipelineConfig

metadata:
  name: pettingzoo_space_invaders_litellm_ai_demo
  description: PettingZoo Atari space_invaders demo (LiteLLM local model, LLM vs LLM).

custom:
  steps:
    - step: arena
      adapter_id: pettingzoo_space_invaders_arena
    - step: auto_eval

datasets:
  - dataset_id: pettingzoo_space_invaders_litellm_demo
    loader: jsonl
    params:
      path: tests/data/pettingzoo_atari_demo.jsonl
      streaming: false

backends:
  - backend_id: pz_litellm_player_0
    type: litellm
    config:
      provider: openai
      api_base: ${PZ_LITELLM_API_BASE:-http://10.217.219.2:2722/v1}
      model: ${PZ_LITELLM_MODEL:-/mnt/model/qwen3_omni_30b/}
      generation_parameters:
        max_new_tokens: 64
        temperature: 0.2
      streaming: false
      max_retries: 4
  - backend_id: pz_litellm_player_1
    type: litellm
    config:
      provider: openai
      api_base: ${PZ_LITELLM_API_BASE:-http://10.217.219.2:2722/v1}
      model: ${PZ_LITELLM_MODEL:-/mnt/model/qwen3_omni_30b/}
      generation_parameters:
        max_new_tokens: 64
        temperature: 0.2
      streaming: false
      max_retries: 4

role_adapters:
  - adapter_id: pz_litellm_player_0
    role_type: dut_model
    backend_id: pz_litellm_player_0
    capabilities: [chat_completion]
  - adapter_id: pz_litellm_player_1
    role_type: dut_model
    backend_id: pz_litellm_player_1
    capabilities: [chat_completion]

  - adapter_id: pettingzoo_space_invaders_arena
    role_type: arena
    params:
      # action_labels are now automatically resolved from env_id via constants.py
      environment:
        impl: pettingzoo_aec_v1
        env_id: pettingzoo.atari.space_invaders_v2
        env_kwargs:
          render_mode: human
          max_cycles: 300
        seed: 1234
        include_raw_obs: false
        use_action_meanings: true
      rules:
        illegal_policy:
          retry: 1
          on_fail: loss
      scheduler:
        type: turn
        max_turns: 300
      parser:
        impl: discrete_action_parser_v1
      players:
        - name: player_0
          player_id: player_0
          type: backend
          ref: pz_litellm_player_0
          max_retries: 1
          fallback_policy: first_legal
        - name: player_1
          player_id: player_1
          type: backend
          ref: pz_litellm_player_1
          max_retries: 1
          fallback_policy: first_legal


tasks:
  - task_id: pettingzoo_space_invaders_litellm_ai
    dataset_id: pettingzoo_space_invaders_litellm_demo
    max_samples: 1
    concurrency: 1
    reporting:
      sinks:
        - type: console
